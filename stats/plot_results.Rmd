---
title: "R Notebook"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

Plot results
add full model
```{r}
rm(list=ls())
library(knitr)
library(xtable)
library(dplyr)
setwd("~/Software/FCPC/stats")
source("~/Software/FCPC/stats/prediction_funcs.R")
BWRES=1000
POINTSIZE = 35
CEX_AXIS = 70
CEX_TITLE = 90
CEX_LINE = 3
CEX_TEXT = 50

OUTPUT_DIR = "~/Data/NSPN/module_stats/"

module_labels_ = c("SMT", #somatosensory + motor",
                  "IMOFC", # ventral frontal
                  "BGTMP", # basal ganglia + salience
                  "DLPFC", # dorsolateral prefrontal
                  "DMPFC", # dorsomedial prefrontal
                  "VIS",  # dorsomedial visual
                  "PDMN")  # default mode

all_module_labels_ = c(module_labels_, "All")
alpha = 0.05
fdr_correct = seq(length(module_labels_))
```



Decision acuity

```{r }

RESULTS_DIR = file.path(OUTPUT_DIR, "mediation_data_2k_7mods_200_decAc")
RESULTS_FILE = file.path(RESULTS_DIR, "data.RData")
load(RESULTS_FILE)
source("~/Software/FCPC/stats/prediction_funcs.R")
FIGS_DIR = RESULTS_DIR
print(var.prediction.results$cor.test)
plot_combinations(var.mediation.network.results, var.prediction.results$cor.test$estimate, module_labels_, "decision acuity")

make_mediation_table(all.mediation.results, all_module_labels_, fdr_correct = fdr_correct)

output_results(DIR_ICA_ME, var.prediction.results, RESULTS_DIR, modules)

```

Does IQ explain the prediction?

```{r}
results = var.prediction.results

data.M = results$covars.exp
data.M$Subject = results$Subject
data.M$y = results$y.test.mean
data.M$decAc_pr = results$y.pred.mean
data.M$sex = as.factor(data.M$sex.num)

# recover IQ
data.all = merge(data.M, demo.pars[c("Subject", "IQmatrix", "IQvocab", "IQ")], by = "Subject")

model.Y = lm(y ~ age.1*sex + brain_vol + fd + meica_dof + UCL + CBU + decAc_pr, data = data.all)  
model.IQ0 = lm(y ~ age.1*sex + brain_vol + fd + meica_dof + UCL + CBU +  decAc_pr + IQmatrix + IQvocab, data = data.all)  

model.IQ = lm(y ~ age.1*sex + brain_vol + fd + meica_dof + UCL + CBU +  decAc_pr + IQ, data = data.all)  
model.M = lm(IQ ~ age.1*sex + brain_vol + fd + meica_dof + UCL + CBU +  decAc_pr, data = data.all)  
NSIMS = 2000
mediation.IQ = mediate(model.M, model.IQ, treat = "decAc_pr", mediator = "IQ", boot = T, sims = NSIMS)

print(summary(model.Y))
print(summary(model.IQ0))
print(summary(model.IQ))
print(summary(mediation.IQ))


```

IQmatrix

```{r}

RESULTS_DIR = file.path(OUTPUT_DIR, "mediation_data_2k_7mods_200_IQmatrix")
RESULTS_FILE = file.path(RESULTS_DIR, "data.RData")
load(RESULTS_FILE)
source("~/Software/FCPC/stats/prediction_funcs.R")
FIGS_DIR = RESULTS_DIR
print(var.prediction.results$cor.test)
plot_combinations(var.mediation.network.results, var.prediction.results$cor.test$estimate, module_labels_, "IQ matrix")

make_mediation_table(all.mediation.results, all_module_labels_, fdr_correct = fdr_correct)
#output_results(DIR_ICA_ME, var.prediction.results, RESULTS_DIR)

```

IQvocab

```{r}

RESULTS_DIR = file.path(OUTPUT_DIR, "mediation_data_2k_7mods_200_IQvocab")
RESULTS_FILE = file.path(RESULTS_DIR, "data.RData")
load(RESULTS_FILE)
source("~/Software/FCPC/stats/prediction_funcs.R")
FIGS_DIR = RESULTS_DIR
print(var.prediction.results$cor.test)

plot_combinations(var.mediation.network.results, var.prediction.results$cor.test$estimate, module_labels_, "IQ vocabulary")

make_mediation_table(all.mediation.results, all_module_labels_, fdr_correct = fdr_correct)
#output_results(DIR_ICA_ME, var.prediction.results, RESULTS_DIR)

```

