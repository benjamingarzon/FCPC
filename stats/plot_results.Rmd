---
title: "R Notebook"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r}
rm(list=ls())
library(knitr)
library(xtable)
library(dplyr)
setwd("~/Software/FCPC/stats")
source("~/Software/FCPC/stats/prediction_funcs.R")
BWRES=1000
POINTSIZE = 35
CEX_AXIS = 70
CEX_TITLE = 90
CEX_LINE = 3
CEX_TEXT = 50

OUTPUT_DIR = "~/Data/NSPN/module_stats/"

module_labels_ = c("SMT", #somatosensory + motor",
                   "IMOFC", # ventral frontal
                   "BGTMP", # basal ganglia + salience
                   "DLPFC", # dorsolateral prefrontal
                   "DMPFC", # dorsomedial prefrontal
                   "VIS",  # dorsomedial visual
                   "PDMN")  # default mode

all_module_labels_ = c(module_labels_, "All")
alpha = 0.05
fdr_correct_ = seq(length(all_module_labels_)) # choose between correcting all or only some
```

Decision acuity, non-depressed sample

```{r }

RESULTS_DIR = file.path(OUTPUT_DIR, "mediation_data_nondep_7mods_200_1decAc") 
RESULTS_FILE = file.path(RESULTS_DIR, "data.RData")
load(RESULTS_FILE)
source("~/Software/FCPC/stats/prediction_funcs.R")
FIGS_DIR = RESULTS_DIR

print(var.prediction.results$cor.test.twotailed)
plot_combinations(var.mediation.network.results, var.prediction.results$cor.test.twotailed, module_labels_, "d")
#make_mediation_table(all.mediation.results, all_module_labels_, fdr_correct = fdr_correct_)

# replace correlations by corrected versions

print("------------------------------")
print("Controlling for demographics")
print("------------------------------")


controlfor = c("brain_vol", "fd", "meica_dof",  "UCL", "CBU")

var.corrected.network.results = NULL

for (i in seq(length(var.mediation.network.results))){
  var.corrected.network.results[[i]] = do_correction(DIR_ICA_ME, 
                                                     var.mediation.network.results[[i]], 
                                                     demo.pars,
                                                     controlfor = controlfor)
}

var.corrected.results =  do_correction(DIR_ICA_ME, 
                                       var.mediation.results, 
                                       demo.pars,
                                       controlfor = controlfor)
print(var.corrected.results$cor.test.twotailed)

plot_combinations(var.corrected.network.results, var.corrected.results$cor.test.twotailed, module_labels_, "d\n (Controlling for all covariates except IQ)", myfigname = 'Accuracy-demo_corrected')


print("------------------------------")
print("Controlling forIQ")
print("------------------------------")


controlfor = c("brain_vol", "fd", "meica_dof",  "UCL", "CBU", "IQcomp")

var.corrected.network.results = NULL


for (i in seq(length(var.mediation.network.results))){
  var.corrected.network.results[[i]] = do_correction(DIR_ICA_ME, 
                                                     var.mediation.network.results[[i]], 
                                                     demo.pars,
                                                     controlfor = controlfor)
}

var.corrected.results =  do_correction(DIR_ICA_ME, 
                                       var.mediation.results, 
                                       demo.pars,
                                       controlfor = controlfor)

print(var.corrected.results$cor.test.twotailed)

plot_combinations(var.corrected.network.results, var.corrected.results$cor.test.twotailed, module_labels_, "d\n (Controlling for all covariates including IQ)", myfigname = 'Accuracy-IQ_corrected')

```



IQ composite, non-depressed sample

```{r}

RESULTS_DIR = file.path(OUTPUT_DIR, "mediation_data_nondep_7mods_200_1IQcomp")
RESULTS_FILE = file.path(RESULTS_DIR, "data.RData")
load(RESULTS_FILE)
source("~/Software/FCPC/stats/prediction_funcs.R")
FIGS_DIR = RESULTS_DIR
print(var.prediction.results$cor.test.twotailed)
plot_combinations(var.mediation.network.results, var.prediction.results$cor.test.twotailed, module_labels_, "IQ")

#make_mediation_table(all.mediation.results, all_module_labels_, fdr_correct = fdr_correct_)

#output_results(DIR_ICA_ME, var.prediction.results, RESULTS_DIR)

# replace correlations by corrected versions

print("------------------------------")
print("Controlling for demographics")
print("------------------------------")


controlfor = c("brain_vol", "fd", "meica_dof",  "UCL", "CBU")

var.corrected.network.results = NULL

for (i in seq(length(var.mediation.network.results))){
  var.corrected.network.results[[i]] = do_correction(DIR_ICA_ME, 
                                                     var.mediation.network.results[[i]], 
                                                     demo.pars,
                                                     controlfor = controlfor)
}

var.corrected.results =  do_correction(DIR_ICA_ME, 
                                       var.mediation.results, 
                                       demo.pars,
                                       controlfor = controlfor)

print(var.corrected.results$cor.test.twotailed)

plot_combinations(var.corrected.network.results, var.corrected.results$cor.test.twotailed, module_labels_, "IQ\n (Controlling for all covariates except d)", myfigname = 'Accuracy-demo_corrected')


print("------------------------------")
print("Controlling for decAc")
print("------------------------------")


controlfor = c("brain_vol", "fd", "meica_dof",  "UCL", "CBU", "decAc")

var.corrected.network.results = NULL

for (i in seq(length(var.mediation.network.results))){
  var.corrected.network.results[[i]] = do_correction(DIR_ICA_ME, 
                                                     var.mediation.network.results[[i]], 
                                                     demo.pars,
                                                     controlfor = controlfor)
}

var.corrected.results =  do_correction(DIR_ICA_ME, 
                                       var.mediation.results, 
                                       demo.pars,
                                       controlfor = controlfor)

print(var.corrected.results$cor.test.twotailed)

plot_combinations(var.corrected.network.results, var.corrected.results$cor.test.twotailed, module_labels_, "IQ\n (Controlling for all covariates including d)", myfigname = 'Accuracy-decAc_corrected')


```

